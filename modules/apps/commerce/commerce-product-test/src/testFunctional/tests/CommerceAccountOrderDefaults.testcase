@component-name = "portal-commerce"
definition {

	property custom.properties = "jsonws.web.service.paths.excludes=${line.separator}company.security.strangers.verify=false";
	property portal.release = "true";
	property portal.upstream = "true";
	property release.feature.flags.disable.DISABLE_PRIVATE_LAYOUTS = "true";
	property testray.main.component.name = "Order Management";

	setUp {
		task ("Setup: Create Minium site") {
			CommerceConfiguration.commerceSetUp(minium = "true");
		}

		task ("Setup: Create a Commerce Account and Buyer User") {
			CommerceEntry.addAccountEntryUser(
				accountName = "Commerce Account",
				accountType = "Business",
				agreeToTermsAndAnswerReminderQuery = "true",
				createNewAccount = "true",
				requireReset = "false",
				userEmailAddress = "buyer@liferay.com",
				userFirstName = "Buyer",
				userLastName = "User",
				userRole = "Buyer",
				userScreenName = "buyeruser",
				userSiteMembership = "Minium");
		}
	}

	tearDown {
		CommerceConfiguration.commerceTearDown();
	}

	@description = "COMMERCE-9723. The default Delivery Terms and Conditions should persist at checkout."
	@priority = "4"
	test CanAddDefaultDeliveryTermWithCheckout {
		task ("Given two delivery terms with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "2",
				termsType = "Delivery");
		}

		task ("and a delivery term is linked to a shipping method") {
			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");
		}

		task ("and the delivery term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Delivery Term 2",
				termType = "Delivery");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Delivery Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				deliveryTerm = "Delivery Term 2",
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				deliveryTerm = "Delivery Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9854. The default discount for the account should persist when viewing an item."
	@priority = "5"
	test CanAddDefaultDiscount {
		task ("Given 2 different discounts for the same product") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");

			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "20",
				target = "products",
				title = "Discount 2 20% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 2 20% off",
				productName = "U-Joint");
		}

		task ("and the second discount is set as the Account Default") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultDiscount(
				channelEntry = "Minium Portal",
				discountTitle = "Discount 2 20% off");
		}

		task ("When the Minium catalog is viewed by an account user") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium/catalog");
		}

		task ("Then the U-Joint product should display the discounted price set in the default.") {
			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "20",
				productDiscountedPrice = "19.20",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9724. The default Payment Terms and Conditions should persist at checkout."
	@priority = "4"
	test CanAddDefaultPaymentTermWithCheckout {
		task ("Given two payment terms with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "2",
				termsType = "Payment");
		}

		task ("and a payment term is linked to a payment method") {
			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");
		}

		task ("and the payment term is set to the Account Order Default") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Payment Term 2",
				termType = "Payment");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Payment Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				paymentTerm = "Payment Term 2",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				paymentTerm = "Payment Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9937. A default currency can be deleted."
	@priority = "4"
	test CanDeleteDefaultCurrency {
		task ("Given an account with a default Currency") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCurrency(currencyName = "Euro");
		}

		task ("When the admin deletes the default currency") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.deleteDefaultSetting(
				currentDefault = "Euro",
				settingHeader = "Currencies");
		}

		task ("Then the default currency should be deleted") {
			AssertElementNotPresent(
				key_entryDetail = "Euro",
				key_settingHeader = "Currencies",
				locator1 = "Account#DEFAULT_SETTINGS_TABLE_ITEM");
		}
	}

	@description = "COMMERCE-9934. Default currency can be edited."
	@priority = "5"
	test CanEditDefaultCurrency {
		task ("Given an account with a default Currency") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCurrency(currencyName = "Euro");
		}

		task ("When the admin edits the default currency") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.editCommerceDefaultSetting(
				currentDefault = "Euro",
				newDefault = "Brazilian Real",
				settingHeader = "Currencies",
				settingLabel = "Currency");
		}

		task ("Then the new default currency should persist") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			AssertElementPresent(
				key_entryDetail = "Brazilian Real",
				key_settingHeader = "Currencies",
				locator1 = "Account#DEFAULT_SETTINGS_TABLE_ITEM");
		}
	}

	@description = "COMMERCE-9729. As a sales manager, I want to set default account delivery terms per channel"
	@priority = "3"
	test CanHaveAllChannelsLinkedToADeliveryTerm {
		task ("Given the admin creates two delivery terms entries with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "2",
				termsType = "Delivery");
		}

		task ("When the admin goes into the "Channel Defaults" for the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");
		}

		task ("And goes into the section "Delivery Terms And Conditions"") {
			Click(
				key_termType = "Delivery",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then the admin will see only the option "All Channels" and channel "Minium Portal"") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");
		}

		task ("When the admin links the channel "Minium Portal" to a delivery") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Delivery Term 1",
				termType = "Delivery");
		}

		task ("Then the option "All Channels" will become "All Other Channels"") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Delivery",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");

			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			AssertTextEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Channels");

			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.removeDefaultCommerceTerms(
				entryDetails = "Delivery Term 1",
				termType = "Delivery");
		}

		task ("When the admin links "All Channels" to a delivery") {
			Accounts.setDefaultCommerceTermsEntry(
				termEntry = "Delivery Term 1",
				termType = "Delivery");
		}

		task ("And the entries table contains "All Channels" linked to the delivery") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.viewDefaultDeliveryCommerceTermsEntry(
				termEntry = "All Channels,Delivery Term 1,Yes,No",
				termType = "Delivery");
		}

		task ("And admin links the channel "Minium Portal" to a delivery") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Delivery Term 2",
				termType = "Delivery");
		}

		task ("Then entries tables should show "All Other Channels" instead of "All Channels" ") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.viewDefaultDeliveryCommerceTermsEntry(
				termEntry = "All Other Channels,Delivery Term 1,Yes,No",
				termType = "Delivery");
		}
	}

	@description = "COMMERCE-9730. As a sales manager, I want to set default account payment terms per channel"
	@priority = "3"
	test CanHaveAllChannelsLinkedToAPaymentTerm {
		task ("Given the admin creates two payment terms entries with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "2",
				termsType = "Payment");
		}

		task ("When the admin goes into the "Channel Defaults" for the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");
		}

		task ("And goes into the section "Payment Terms And Conditions"") {
			Click(
				key_termType = "Payment",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then the admin will see only the option "All Channels" and channel "Minium Portal"") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");
		}

		task ("And when the admin links the channel "Minium Portal" to a payment") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Payment Term 1",
				termType = "Payment");
		}

		task ("Then the option "All Channels" will become "All Other Channels"") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Payment",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");

			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			AssertTextEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Channels");

			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.removeDefaultCommerceTerms(
				entryDetails = "Payment Term 1",
				termType = "Payment");
		}

		task ("And when the admin links "All Channels" to a payment") {
			Accounts.setDefaultCommerceTermsEntry(
				termEntry = "Payment Term 1",
				termType = "Payment");
		}

		task ("And the entries table contains "All Channels" linked to the payment") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.viewDefaultDeliveryCommerceTermsEntry(
				termEntry = "All Channels,Payment Term 1,Yes,No",
				termType = "Payment");
		}

		task ("And admin links the channel "Minium Portal" to a payment") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Payment Term 2",
				termType = "Payment");
		}

		task ("Then entries tables should show "All Other Channels" instead of "All Channels" ") {
			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.viewDefaultDeliveryCommerceTermsEntry(
				termEntry = "All Other Channels,Payment Term 1,Yes,No",
				termType = "Payment");
		}
	}

	@description = "COMMERCE-9885. Assert that can not assign default addresses to the same Channel."
	@priority = "3"
	test CanNotAssignDefaultAddressesToTheSameChannel {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			Accounts.addAddress(
				addressCity = "Chicago",
				addressCountry = "United States",
				addressName = "Test Billing Address",
				addressPostalCode = "60606",
				addressRegion = "Illinois",
				addressStreet1 = "205 W. Wacker Dr",
				addressStreet2 = "Suite 720",
				addressType = "Billing",
				phoneNumber = "+1-877-LIFERAY (1-877-543-3729)");

			Accounts.addAddress(
				addressCity = "Shibuya-ku",
				addressCountry = "Japan",
				addressName = "Test Shipping Address",
				addressPostalCode = "150-0021",
				addressRegion = "Tokyo",
				addressStreet1 = "1F Faveur Ebisu,",
				addressStreet2 = "1-26-7 Ebisu Nishi",
				addressType = "Shipping",
				phoneNumber = "+81 3-5456-5796");

			Accounts.addAddress(
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Test Billing and Shipping Address",
				addressPostalCode = "91765",
				addressRegion = "California",
				addressStreet1 = "1400 Montefino Ave",
				addressType = "Billing and Shipping",
				phoneNumber = "+1-877-LIFERAY (1-877-543-3729)");
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("Given there is a default billing address set for Minium Portal Channel") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Test Billing Address",
				addressType = "Billing",
				channelEntry = "Minium Portal");
		}

		task ("And there is a default billing address set for All Other Channels") {
			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Test Billing and Shipping Address",
				addressType = "Billing",
				channelEntry = "All Other Channels");
		}

		task ("When the admin clicks + button to set another default, and tries to set a default for All Other Channels again") {
			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Test Billing Address",
				addressType = "Billing",
				channelEntry = "All Other Channels");
		}

		task ("Then an error message appears on the modal") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			AssertTextEquals.assertPartialText(
				locator1 = "Message#ERROR_DISMISSIBLE",
				value1 = "There is already an address defined for the selected channel.");
		}
	}

	@description = "COMMERCE-9734. As admin, I want to set a default billing and default shipping address for one account and channel, then buyer cannot use the default addresses in a different channel to make an order"
	@priority = "3"
	test CanNotUseDefaultAddressesInADifferentChannel {
		task ("Given 2 minium sites, 2 accounts and 2 buyer users are created and associated with the respected accounts and sites") {
			for (var num : list "1,2") {
				CommerceAccelerators.initializeNewSiteViaAccelerator(
					siteName = "Minium ${num}",
					siteTemplateName = "Minium");

				CommerceEntry.addAccountEntryUser(
					accountName = "Test Account ${num}",
					accountType = "Business",
					agreeToTermsAndAnswerReminderQuery = "true",
					createNewAccount = "true",
					requireReset = "false",
					userEmailAddress = "buyer${num}@liferay.com",
					userFirstName = "Buyer${num}",
					userLastName = "User${num}",
					userRole = "Buyer",
					userScreenName = "buyeruser${num}",
					userSiteMembership = "Minium ${num}");

				Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

				task ("And each account having 3 addresses: one billing, one shipping and one shipping and billing for the account") {
					for (var typeList : list "Billing,Shipping,Billing and Shipping") {
						Accounts.addAddressViaSetDefaultAddress(
							addressCity = "Diamond Bar",
							addressCountry = "United States",
							addressName = "${typeList} Address Entry 1",
							addressPostalCode = "91765",
							addressRegion = "California",
							addressStreet1 = "1400 Montefino Ave",
							addressType = "${typeList}",
							phoneNumber = "+1-877-543-3729");
					}
				}
			}
		}

		task ("And a default billing and default shipping address is selected for Minium 1 Portal Channel for Test Account 1") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Test Account 1");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			for (var typeList : list "Billing,Shipping") {
				Accounts.addDefaultCommerceAddressEntry(
					addressEntry = "${typeList} Address Entry 1",
					addressType = "${typeList}",
					channelEntry = "Minium 1 Portal");
			}
		}

		task ("And buyer user 2 from Test Account 2 and Minium 2 Portal Channel adds an order and starts the checkout process") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium-3",
				userEmailAddress = "buyer2@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckout();
		}

		task ("When the buyer views the shipping and billing address sections, there should be no default address pre-selected") {
			AssertElementPresent(
				key_selectFieldLabel = "Choose Shipping Address",
				locator1 = "Select#ANY",
				value1 = "Add New Address");

			for (var fieldNames : list "Name,Address,Zip,City") {
				AssertElementNotPresent(
					key_fieldName = "${fieldNames}",
					locator1 = "CommerceAccelerators#CHECKOUT_GENERIC_TEXT_INPUT_DISABLED");
			}
		}

		task ("Then after completing the checkout by giving new addresses, the shipping and the billing address given by buyer 2 are visible in the Order Summary") {
			CommerceCheckout.initializersCheckout(
				billingAddressAddress = "United States",
				billingAddressCity = "Test Billing City",
				billingAddressCountry = "United States",
				billingAddressName = "New Billing Address Name",
				billingAddressZipCode = "Test Zip Code",
				newAddressAddress = "Test Shipping Address",
				newAddressCity = "Test Shipping City",
				newAddressCountry = "United States",
				newAddressName = "New Shipping Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard",
				viewBillingAddressPermission = "true");
		}
	}

	@description = "COMMERCE-9725. A default delivery term that has been disabled should not be displayed at checkout."
	@priority = "4"
	test CannotUseDisabledDefaultDeliveryTerm {
		task ("Given three delivery term entries with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "3",
				termsType = "Delivery");
		}

		task ("and two delivery terms are linked to a payment method") {
			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 1",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");
		}

		task ("and the delivery term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Delivery Term 2",
				termType = "Delivery");
		}

		task ("and the default delivery term is deactivated") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Delivery Term 2");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Delivery Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				deliveryTerm = "Delivery Term 1",
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				deliveryTerm = "Delivery Term 1",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9726. A default payment term that has been disabled should not be displayed at checkout."
	@priority = "4"
	test CannotUseDisabledDefaultPaymentTerms {
		task ("Given three payment term entries with different priorities") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "3",
				termsType = "Payment");
		}

		task ("and two payment terms are linked to a payment method") {
			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 1");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");
		}

		task ("and a payment term is set to the Account Order Default") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Payment Term 2",
				termType = "Payment");
		}

		task ("and the default payment term is deactivated") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Payment Term 2");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Payment Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				paymentTerm = "Payment Term 1",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				paymentTerm = "Payment Term 1",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9876. As a Sales Manager, I want to remove default billing and shipping addresses from the account"
	@priority = "3"
	test CanRemoveDefaultAddresses {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			for (var typeList : list "Billing,Shipping,Billing and Shipping") {
				Accounts.addAddressViaSetDefaultAddress(
					addressCity = "Diamond Bar",
					addressCountry = "United States",
					addressName = "${typeList} Address Entry 1",
					addressPostalCode = "91765",
					addressRegion = "California",
					addressStreet1 = "1400 Montefino Ave",
					addressType = "${typeList}",
					phoneNumber = "+1-877-543-3729");
			}
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("Given there is a default billing and a default shipping address set for the Account and Channel") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Billing Address Entry 1",
				addressType = "Billing",
				channelEntry = "Test Channel 1");

			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Shipping Address Entry 1",
				addressType = "Shipping",
				channelEntry = "Test Channel 2");
		}

		task ("When admin removes both default addresses from the account") {
			for (var typeList : list "Billing,Shipping") {
				Accounts.removeDefaultCommerceTerms(
					entryDetails = "${typeList} Address Entry 1",
					termType = "${typeList}");
			}
		}

		task ("And user makes an order") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");
		}

		task ("Then during the checkout there is no default address pre-selected") {
			CommerceCheckout.gotoCheckout();

			AssertElementPresent(
				key_selectFieldLabel = "Choose Shipping Address",
				locator1 = "Select#ANY",
				value1 = "Add New Address");

			for (var fieldNames : list "Name,Address,Zip,City") {
				AssertElementNotPresent(
					key_fieldName = "${fieldNames}",
					locator1 = "CommerceAccelerators#CHECKOUT_GENERIC_TEXT_INPUT_DISABLED");
			}
		}

		task ("And user enters new addresses that will be visible in Order Summary") {
			CommerceCheckout.initializersCheckout(
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "New Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");
		}
	}

	@description = "COMMERCE-9857. All sites should display the product discount when the discount is set to All Channels."
	@priority = "4"
	test CanSelectAllOtherChannelsForDefaultDiscount {
		task ("Given a second Minium site") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Minium 2",
				siteTemplateName = "Minium");
		}

		task ("and a discount that is applied to the U-joint product") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");
		}

		task ("When the discount is set as the account default") {
			ApplicationsMenu.gotoSite(site = "Minium");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account");

			Accounts.setDefaultDiscount(
				discountTitle = "Discount 1 10% off",
				override = "true");
		}

		task ("Then both Minium sites should show U-joint with a 10% discount applied.") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "10",
				productDiscountedPrice = "21.60",
				productListPrice = "24.00");

			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium-2/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "10",
				productDiscountedPrice = "21.60",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9829. As a sales manager, I want to check channel options after setting a default account billing address for each channel"
	@priority = "3"
	test CanSelectOnlyAllOtherChannelsForDefaultBillingAddress {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			for (var typeList : list "Billing,Shipping,Billing and Shipping") {
				Accounts.addAddressViaSetDefaultAddress(
					addressCity = "Diamond Bar",
					addressCountry = "United States",
					addressName = "${typeList} Address Entry 1",
					addressPostalCode = "91765",
					addressRegion = "California",
					addressStreet1 = "1400 Montefino Ave",
					addressType = "${typeList}",
					phoneNumber = "+1-877-543-3729");
			}
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("Given a default billing address is selected for each Channel (Minium Portal, Test Channel 1 and Test Channel 2)") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			for (var channelEntries : list "Minium Portal,Test Channel 1,Test Channel 2") {
				Accounts.addDefaultCommerceAddressEntry(
					addressEntry = "Billing Address Entry 1",
					addressType = "Billing",
					channelEntry = "${channelEntries}");
			}
		}

		task ("When admin clicks to the plus button to add another default address") {
			Click(
				key_termType = "Billing",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then only All Other Channels option is listed in the Channel dropdown") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal,Test Channel 1,Test Channel 2") {
				AssertTextNotEquals(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");
		}
	}

	@description = "COMMERCE-9829. As a sales manager, I want to check channel options after setting a default account shipping address for each channel"
	@priority = "3"
	test CanSelectOnlyAllOtherChannelsForDefaultShippingAddress {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			for (var typeList : list "Billing,Shipping,Billing and Shipping") {
				Accounts.addAddressViaSetDefaultAddress(
					addressCity = "Diamond Bar",
					addressCountry = "United States",
					addressName = "${typeList} Address Entry 1",
					addressPostalCode = "91765",
					addressRegion = "California",
					addressStreet1 = "1400 Montefino Ave",
					addressType = "${typeList}",
					phoneNumber = "+1-877-543-3729");
			}
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("Given a default shipping address is selected for each Channel (Minium Portal, Test Channel 1 and Test Channel 2)") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			for (var channelEntries : list "Minium Portal,Test Channel 1,Test Channel 2") {
				Accounts.addDefaultCommerceAddressEntry(
					addressEntry = "Shipping Address Entry 1",
					addressType = "Shipping",
					channelEntry = "${channelEntries}");
			}
		}

		task ("When admin clicks to the plus button to add another default address") {
			Click(
				key_termType = "Shipping",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then only All Other Channels option is listed in the Channel dropdown") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal,Test Channel 1,Test Channel 2") {
				AssertTextNotEquals(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Other Channels");
		}
	}

	@description = "COMMERCE-9733. As a sales manager, I want to set a default account billing address per channel when the buyer users are placing orders"
	@priority = "3"
	test CanSetDefaultBillingAddressPerChannel {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			for (var typeList : list "Billing,Shipping,Billing and Shipping") {
				Accounts.addAddressViaSetDefaultAddress(
					addressCity = "Diamond Bar",
					addressCountry = "United States",
					addressName = "${typeList} Address Entry 1",
					addressPostalCode = "91765",
					addressRegion = "California",
					addressStreet1 = "1400 Montefino Ave",
					addressType = "${typeList}",
					phoneNumber = "+1-877-543-3729");
			}
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("When admin wants to set a default billing address for the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Billing",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then the options All Channels, Minium Portal Channel, Test Channel 1 and Test Channel 2 are listed") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal,Test Channel 1,Test Channel 2") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}
		}

		task ("And only addresses flagged as "Billing" and "Shipping and Billing" are listed") {
			for (var addressEntries : list "Billing Address Entry 1,Billing and Shipping Address Entry 1") {
				AssertTextPresent(
					key_fieldLabel = "Address",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${addressEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Address",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "Shipping Address Entry 1");
		}

		task ("When a default billing address is selected for Minium Portal Channel and the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Billing Address Entry 1",
				addressType = "Billing",
				channelEntry = "Minium Portal");
		}

		task ("And admin clicks back to the default address") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Billing",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then only All Other Channels, Test Channel 1 and Test Channel 2 are visible (not All Channels)") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Other Channels,Test Channel 1,Test Channel 2") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Channels");
		}

		task ("When buyer adds an order and starts the checkout process after setting a default billing address for Minium Portal Channel and account") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckout();
		}

		task ("And after entering shipping address, "Use shipping address as billing address" is already unchecked") {
			Select(
				key_selectFieldLabel = "Choose Shipping Address",
				locator1 = "Select#ANY",
				value1 = "Shipping Address Entry 1");

			Uncheck.uncheckToggleSwitch(
				checkboxName = "Use shipping address as billing address",
				locator1 = "Checkbox#ANY_CHECKBOX");

			Click(locator1 = "Button#CONTINUE");

			Click(locator1 = "Button#CONTINUE");
		}

		task ("And arrives to the billing address section, the default billing address is pre-selected") {
			AssertElementPresent(
				key_fieldLabel = "Choose Billing Address",
				key_value = "Billing Address Entry 1",
				locator1 = "CommerceEntry#SELECT_ASSERT_SELECTED_VALUE");

			for (var fieldNames : list "Name,Address,Zip,City") {
				AssertElementPresent(
					key_fieldName = "${fieldNames}",
					locator1 = "CommerceAccelerators#CHECKOUT_GENERIC_TEXT_INPUT_DISABLED");
			}

			Click(locator1 = "Button#CONTINUE");
		}

		task ("Then after completing the checkout, the default billing address is visible in the Order Summary") {
			CommerceCheckout.viewCheckoutOrderSummary(
				addressAddress = "1400 Montefino Ave",
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Shipping Address Entry 1",
				billingAddressAddress = "1400 Montefino Ave",
				billingAddressCity = "Diamond Bar",
				billingAddressCountry = "United States",
				billingAddressName = "Billing Address Entry 1",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");
		}
	}

	@description = "COMMERCE-9922. The default currency can be set for a channel."
	@priority = "5"
	test CanSetDefaultCurrencyPerChannel {
		task ("Given an account with a default Currency") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCurrency(currencyName = "Euro");
		}

		task ("When the admin views the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");
		}

		task ("Then the default currency should persist") {
			AssertElementPresent(
				key_entryDetail = "Euro",
				key_settingHeader = "Currencies",
				locator1 = "Account#DEFAULT_SETTINGS_TABLE_ITEM");
		}
	}

	@description = "COMMERCE-9732. As a sales manager, I want to set a default account shipping address per channel when the buyer users are placing orders"
	@priority = "3"
	test CanSetDefaultShippingAddressPerChannel {
		task ("Given 3 addresses: one billing, one shipping and one shipping and billing for the account") {
			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			for (var typeList : list "Billing,Shipping,Billing and Shipping") {
				Accounts.addAddressViaSetDefaultAddress(
					addressCity = "Diamond Bar",
					addressCountry = "United States",
					addressName = "${typeList} Address Entry 1",
					addressPostalCode = "91765",
					addressRegion = "California",
					addressStreet1 = "1400 Montefino Ave",
					addressType = "${typeList}",
					phoneNumber = "+1-877-543-3729");
			}
		}

		task ("And two more channels("Test Channel 1" and "Test Channel 2")") {
			for (var channelNames : list "Test Channel 1,Test Channel 2") {
				CommerceJSONChannelsAPI._addChannel(
					channelName = "${channelNames}",
					channelType = "site",
					currencyCode = "USD");
			}
		}

		task ("When admin wants to set a default shipping address for the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Shipping",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then the options All Channels, Minium Portal Channel, Test Channel 1 and Test Channel 2 are listed") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Channels,Minium Portal,Test Channel 1,Test Channel 2") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}
		}

		task ("And only addresses flagged as "Shipping" and "Shipping and Billing" are listed") {
			for (var addressEntries : list "Shipping Address Entry 1,Billing and Shipping Address Entry 1") {
				AssertTextPresent(
					key_fieldLabel = "Address",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${addressEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Address",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "Billing Address Entry 1");
		}

		task ("When a default shipping address is selected for Minium Portal Channel and the account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.addDefaultCommerceAddressEntry(
				addressEntry = "Shipping Address Entry 1",
				addressType = "Shipping",
				channelEntry = "Minium Portal");
		}

		task ("And admin clicks back to the default address") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Click(
				key_termType = "Shipping",
				locator1 = "Account#DEFAULT_ACCOUNT_TERMS_AND_CONDITION_PLUS");
		}

		task ("Then only All Other Channels, Test Channel 1 and Test Channel 2 are visible (not All Channels)") {
			SelectFrame(locator1 = "IFrame#MODAL_BODY");

			for (var channelEntries : list "All Other Channels,Test Channel 1,Test Channel 2") {
				AssertTextPresent(
					key_fieldLabel = "Channel",
					locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
					row = "1",
					value1 = "${channelEntries}");
			}

			AssertTextNotEquals(
				key_fieldLabel = "Channel",
				locator1 = "CommerceEntry#LABEL_GENERIC_SELECT_POSITION",
				row = "1",
				value1 = "All Channels");
		}

		task ("When buyer adds an order and starts the checkout process after setting a default shipping address for Minium Portal Channel and account") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckout();
		}

		task ("And arrives in the shipping address section, the default shipping address is pre-selected") {
			AssertElementPresent(
				key_fieldLabel = "Choose Shipping Address",
				key_value = "Shipping Address Entry 1",
				locator1 = "CommerceEntry#SELECT_ASSERT_SELECTED_VALUE");

			for (var fieldNames : list "Name,Address,Zip,City") {
				AssertElementPresent(
					key_fieldName = "${fieldNames}",
					locator1 = "CommerceAccelerators#CHECKOUT_GENERIC_TEXT_INPUT_DISABLED");
			}
		}

		task ("Then after completing the checkout, the default shipping address is visible in the Order Summary") {
			Check.checkToggleSwitch(
				checkboxName = "Use shipping address as billing address",
				locator1 = "Checkbox#ANY_CHECKBOX");

			Click(locator1 = "Button#CONTINUE");

			Click(locator1 = "Button#CONTINUE");

			CommerceCheckout.viewCheckoutOrderSummary(
				addressAddress = "1400 Montefino Ave",
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Shipping Address Entry 1",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");
		}
	}

	@description = "COMMERCE-9858. The default discount can be updated."
	@priority = "4"
	test CanUpdateDefaultDiscountsEntry {
		task ("Given two active discounts applied to the U-joint product") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");

			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "20",
				target = "products",
				title = "Discount 2 20% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 2 20% off",
				productName = "U-Joint");
		}

		task ("and a default discount is set to the Commerce Account") {
			ApplicationsMenu.gotoSite(site = "Minium");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account");

			Accounts.setDefaultDiscount(
				channelEntry = "Minium Portal",
				discountTitle = "Discount 2 20% off");
		}

		task ("and the U-Joint product displaying the 20% off discount") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "20",
				productDiscountedPrice = "19.20",
				productListPrice = "24.00");
		}

		task ("When the default discount is changed to 10%") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.editCommerceDefaultSetting(
				channelEntry = "Minium Portal",
				currentDefault = "Discount 2 20% off",
				newDefault = "Discount 1 10% off",
				settingHeader = "Discounts",
				settingLabel = "Discount");
		}

		task ("Then the U-Joint product should display the new 10% discount.") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "10",
				productDiscountedPrice = "21.60",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9782. Default delivery set to override should be default regardless of other eligibility criteria."
	@priority = "4"
	test DefaultDeliveryTermCanOverrideOtherEligibilities {
		task ("Given a new Test Channel with an active Shipping method") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Test Channel",
				siteTemplateName = "Minium");
		}

		task ("and four delivery term entries with different priorities and eligibility scopes") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "4",
				termsType = "Delivery");

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 1",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Test Channel Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");
		}

		task ("and a fourth delivery term set to inactive") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Delivery Term 4");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("and the delivery term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				assertInactive = "Delivery Term 4",
				channelEntry = "Minium Portal",
				override = "true",
				termEntry = "Delivery Term 2",
				termType = "Delivery");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Delivery Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				deliveryTerm = "Delivery Term 2",
				managePaymentTerms = "false",
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				deliveryTerm = "Delivery Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9856. The default discount can override Account eligibility."
	@priority = "4"
	test DefaultDiscountCanOverrideAccountEligibility {
		task ("Given a second Minium site and a second account") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Minium 2",
				siteTemplateName = "Minium");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Commerce Account 2",
				accountEntryType = "Business");
		}

		task ("and two active order types") {
			for (var orderTypeNumber : list "1,2") {
				CommerceJSONOrdersAPI._addOrderType(
					active = "true",
					orderTypeDescription = "Test Order Type ${orderTypeNumber} Description",
					orderTypeName = "Order Type ${orderTypeNumber}");
			}
		}

		task ("and an active 10% discount applied to the U-joint product for the first account") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 1 10% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(accountsEligibility = "Commerce Account");
		}

		task ("and an active 20% discount applied to the U-joint product for the Minium channel") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "20",
				target = "products",
				title = "Discount 2 20% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 2 20% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 2 20% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(channelsEligibility = "Minium Portal");
		}

		task ("and an active 30% discount applied to the U-joint product for Order Type 1") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "30",
				target = "products",
				title = "Discount 3 30% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 3 30% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 3 30% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(orderTypesEligibility = "Order Type 1");
		}

		task ("When Discount 1 is set as the account default") {
			ApplicationsMenu.gotoSite(site = "Minium");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account 2");

			Accounts.setDefaultDiscount(
				discountTitle = "Discount 1 10% off",
				override = "true");
		}

		task ("Then viewing the U-joint product for Account 2 shows the 10% discount") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.selectAccountFromAccountSelector(accountName = "Commerce Account 2");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "10",
				productDiscountedPrice = "21.60",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9856. The default discount can override Channel eligibility."
	@priority = "4"
	test DefaultDiscountCanOverrideChannelEligibility {
		task ("Given a second Minium site and a second account") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Minium 2",
				siteTemplateName = "Minium");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Commerce Account 2",
				accountEntryType = "Business");
		}

		task ("and two active order types") {
			for (var orderTypeNumber : list "1,2") {
				CommerceJSONOrdersAPI._addOrderType(
					active = "true",
					orderTypeDescription = "Test Order Type ${orderTypeNumber} Description",
					orderTypeName = "Order Type ${orderTypeNumber}");
			}
		}

		task ("and an active 10% discount applied to the U-joint product for the first account") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 1 10% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(accountsEligibility = "Commerce Account");
		}

		task ("and an active 20% discount applied to the U-joint product for the Minium channel") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "20",
				target = "products",
				title = "Discount 2 20% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 2 20% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 2 20% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(channelsEligibility = "Minium Portal");
		}

		task ("and an active 30% discount applied to the U-joint product for Order Type 1") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "30",
				target = "products",
				title = "Discount 3 30% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 3 30% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 3 30% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(orderTypesEligibility = "Order Type 1");
		}

		task ("When Discount 2 is set as the account default") {
			ApplicationsMenu.gotoSite(site = "Minium 2");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account 2");

			Accounts.setDefaultDiscount(
				channelEntry = "Minium 2 Portal",
				discountTitle = "Discount 2 20% off",
				override = "true");
		}

		task ("Then viewing the U-joint product on the Minium 2 site for Account 2 shows the 20% discount") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium-2/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.selectAccountFromAccountSelector(accountName = "Commerce Account 2");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "20",
				productDiscountedPrice = "19.20",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9856. The default discount can override Order Type eligibility."
	@ignore = "true"
	@priority = "4"
	test DefaultDiscountCanOverrideOrderTypeEligibility {

		// Ignore until steps are verified. COMMERCE-9856.

		task ("Given a second Minium site and a second account") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Minium 2",
				siteTemplateName = "Minium");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Commerce Account 2",
				accountEntryType = "Business");
		}

		task ("and two active order types") {
			for (var orderTypeNumber : list "1,2") {
				CommerceJSONOrdersAPI._addOrderType(
					active = "true",
					orderTypeDescription = "Test Order Type ${orderTypeNumber} Description",
					orderTypeName = "Order Type ${orderTypeNumber}");
			}
		}

		task ("and an active 10% discount applied to the U-joint product for the first account") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "10",
				target = "products",
				title = "Discount 1 10% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 1 10% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 1 10% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(accountsEligibility = "Commerce Account");
		}

		task ("and an active 20% discount applied to the U-joint product for the Minium channel") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "20",
				target = "products",
				title = "Discount 2 20% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 2 20% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 2 20% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(channelsEligibility = "Minium Portal");
		}

		task ("and an active 30% discount applied to the U-joint product for Order Type 1") {
			CommerceJSONDiscountsAPI._addDiscount(
				active = "true",
				level = "L1",
				percentageLevel1 = "30",
				target = "products",
				title = "Discount 3 30% off",
				usePercentage = "true");

			CommerceJSONDiscountsAPI._addDiscountProduct(
				discountTitle = "Discount 3 30% off",
				productName = "U-Joint");

			CommerceNavigator.gotoPortlet(
				category = "Pricing",
				portlet = "Discounts");

			CommerceNavigator.gotoEntry(entryName = "Discount 3 30% off");

			CommerceEntry.gotoMenuTab(menuTab = "Eligibility");

			CommerceEntry.setEntryEligibility(orderTypesEligibility = "Order Type 1");
		}

		task ("When Discount 3 is set as the account default") {
			ApplicationsMenu.gotoSite(site = "Minium");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account 2");

			CommerceNavigator.gotoMiniumAccountOrderDefaults(accountName = "Commerce Account 2");

			Accounts.setDefaultDiscount(
				discountTitle = "Discount 3 30% off",
				override = "true");
		}

		task ("Then viewing the U-joint product on the Minium 2 site for Account 2 shows the 20% discount") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/minium-2/catalog");

			CommerceAcceleratorsInitializer.gotoMiniumProductDetailsPage(productName = "U-Joint");

			CommerceAcceleratorsInitializer.selectAccountFromAccountSelector(accountName = "Commerce Account 2");

			CommerceAcceleratorsInitializer.viewDiscountedProductDetailsPage(
				discountPercentage = "30",
				productDiscountedPrice = "16.80",
				productListPrice = "24.00");
		}
	}

	@description = "COMMERCE-9782. Default payment set to override should be default regardless of other eligibility criteria."
	@priority = "4"
	test DefaultPaymentTermCanOverrideOtherEligibilities {
		task ("Given a new Test Channel with an active Shipping method") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Test Channel",
				siteTemplateName = "Minium");
		}

		task ("and four delivery term entries with different priorities and eligibility scopes") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "4",
				termsType = "Payment");

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 1");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Test Channel Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");
		}

		task ("and a fourth payment term set to inactive") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Payment Term 4");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("and the payment term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				assertInactive = "Payment Term 4",
				channelEntry = "Minium Portal",
				override = "true",
				termEntry = "Payment Term 2",
				termType = "Payment");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Delivery Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				deliveryTerm = "Payment Term 2",
				managePaymentTerms = "false",
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				deliveryTerm = "Payment Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9785. Delivery eligibility rules scoped to channels should persist at checkout."
	@priority = "4"
	test DeliveryEligibilityRulesCanPersistAtCheckout {
		task ("Given a new Test Channel with an active Shipping method") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Test Channel",
				siteTemplateName = "Minium");
		}

		task ("and four delivery term entries with different priorities and eligibility scopes") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "4",
				termsType = "Delivery");

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 1",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Test Channel Portal");

			CommerceEntry.setEntryEligibility(
				deliveryTermsEligibility = "Delivery Term 2",
				shippingMethod = "Flat Rate",
				shippingOption = "Standard Delivery");
		}

		task ("and a fourth delivery term set to inactive") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Delivery Term 4");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("and the delivery term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Delivery Term 1",
				termType = "Delivery");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Delivery Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				deliveryTerm = "Delivery Term 2",
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				deliveryTerm = "Delivery Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

	@description = "COMMERCE-9785. Payment eligibility rules scoped to channels should persist at checkout."
	@priority = "4"
	test PaymentEligibilityRulesCanPersistAtCheckout {
		task ("Given a new Test Channel with an active Shipping method") {
			CommerceAccelerators.initializeNewSiteViaAccelerator(
				siteName = "Test Channel",
				siteTemplateName = "Minium");
		}

		task ("and four delivery term entries with different priorities and eligibility scopes") {
			CommerceJSONTermsAndConditionsAPI._addCommerceTermsAndConditions(
				termsCount = "4",
				termsType = "Payment");

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 1");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Minium Portal");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");

			SelectFrame.selectFrameTop();

			ApplicationsMenu.gotoPortlet(
				category = "Store Management",
				panel = "Commerce",
				portlet = "Channels");

			CommerceNavigator.gotoEntry(entryName = "Test Channel Portal");

			CommerceChannels.activatePaymentMethod(paymentMethod = "Money Order");

			CommerceEntry.setEntryEligibility(
				paymentMethod = "Money Order",
				paymentTermsEligibility = "Payment Term 2");
		}

		task ("and a fourth payment term set to inactive") {
			CommercePaymentTerms.openTermsAndConditionAdmin();

			CommercePaymentTerms.gotoEntryMenuItem(
				menuItem = "Edit",
				termsAndConditionName = "Payment Term 4");

			CommercePaymentTerms.editTermsAndCondition(deactivate = "true");
		}

		task ("and the payment term is set as the default for the Account") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Commerce Account");

			Accounts.gotoAssigneeTab(assigneeTab = "Channel Defaults");

			Accounts.setDefaultCommerceTermsEntry(
				channelEntry = "Minium Portal",
				termEntry = "Payment Term 2",
				termType = "Payment");
		}

		task ("When a buyer checks out an order and view order details") {
			User.logoutPG();

			CommerceLogin.miniumLogin(
				password = "test",
				urlAppend = "web/minium",
				userEmailAddress = "buyer@liferay.com");

			FrontStore.addInitializerProductToCart(
				productName = "U-Joint",
				productQuantity = "1");

			CommerceCheckout.gotoCheckoutViaMiniCart();
		}

		task ("Then the default Payment Term should be displayed at Checkout.") {
			CommerceCheckout.initializersCheckout(
				newAddressAddress = "Test Address",
				newAddressCity = "Test City",
				newAddressCountry = "United States",
				newAddressName = "Address Name",
				newAddressZipCode = "Test Zip Code",
				paymentTerm = "Payment Term 2",
				productName = "U-Joint",
				productQuantity = "1",
				productUnitPrice = "24",
				shippingMethod = "Standard");

			Button.click(button = "Go to Order Details");

			CommerceOrders.viewOrdersEntry(
				paymentTerm = "Payment Term 2",
				productListPrice = "24.00",
				productName = "U-Joint",
				productQuantity = "1",
				productSku = "MIN55861",
				productTotalPrice = "24.00");
		}
	}

}