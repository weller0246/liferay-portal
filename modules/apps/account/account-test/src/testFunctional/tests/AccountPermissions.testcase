@component-name = "portal-user-management-and-portal-configuration"
definition {

	property custom.properties = "jsonws.web.service.paths.excludes=";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Account";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		JSONLayout.addPublicLayout(
			groupName = "Guest",
			layoutName = "2B Account Page");

		JSONLayout.addWidgetToPublicLayout(
			column = "1",
			groupName = "Guest",
			layoutName = "2B Account Page",
			widgetName = "Account Management");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Accounts.tearDownCP();
		}
	}

	@description = "This test adds the Add Account Entry permission to Account Admin and assert user can add an account."
	@priority = "5"
	@refactorneeded
	test AccountAdminCanAddAccount {
		property portal.acceptance = "true";

		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		Accounts.setAddAccountEntryPermissions(
			roleTitle = "Reg Role Name",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.addBusinessAccount(
			accountDescription = "Accounts Name Description for Test",
			accountName = "Accounts Name for Test");

		Navigator.gotoPage(pageName = "2B Account Page");

		LexiconEntry.viewEntryName(rowEntry = "Accounts Name for Test");
	}

	@description = "This test asserts that an Account Admin can add a billing address to an Account."
	@priority = "5"
	test AccountAdminCanAddBillingAddressToAccount {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin logs in and adds a billing address to account via widget") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Edit",
				rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			Accounts.addAddressViaSetDefaultAddress(
				addressCity = "Shibuya-ku",
				addressCountry = "Japan",
				addressName = "Liferay Japan K. K.",
				addressPostalCode = "150-0021",
				addressRegion = "Tokyo",
				addressStreet1 = "1F Faveur Ebisu,",
				addressStreet2 = "1-26-7 Ebisu Nishi",
				addressType = "Billing",
				phoneNumber = "+81 3-5456-5796");
		}

		task ("Then the billing address is saved") {
			AssertElementPresent(
				key_tab = "Addresses",
				locator1 = "NavTab#ACTIVE_TAB_LINK");

			Search.searchPG(
				portletName = "Account Name",
				searchTerm = "Liferay Japan K. K.");

			LexiconEntry.viewEntryContent(
				rowAny = "Billing",
				rowEntry = "Liferay Japan K. K.");
		}
	}

	@description = "This test asserts that an Account Admin can add a new user to an account"
	@priority = "5"
	@refactorneeded
	test AccountAdminCanAddNewUserToAccount {
		property portal.acceptance = "true";

		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin log in and adds an account user via widget") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "userea1@liferay.com",
				userFirstName = "userfn1",
				userLastName = "userln1",
				userScreenName = "usersn1");
		}

		task ("Then the account user is successfully added") {
			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Users");

			Accounts.viewAssignee(assigneeName = "userfn1");
		}
	}

	@description = "This test asserts that an Account Admin can add a shipping address to an Account."
	@priority = "5"
	test AccountAdminCanAddShippingAddressToAccount {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin log in and adds a shipping address to account via widget") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Edit",
				rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			Accounts.addAddressViaSetDefaultAddress(
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Liferay, Inc.",
				addressPostalCode = "91765",
				addressRegion = "California",
				addressStreet1 = "1400 Montefino Ave",
				addressType = "Shipping",
				phoneNumber = "+1-877-543-3729");
		}

		task ("Then the shipping address is saved") {
			AssertElementPresent(
				key_tab = "Addresses",
				locator1 = "NavTab#ACTIVE_TAB_LINK");

			Search.searchPG(
				portletName = "Account Name",
				searchTerm = "Liferay, Inc.");

			LexiconEntry.viewEntryContent(
				rowAny = "Shipping",
				rowEntry = "Liferay, Inc.");
		}
	}

	@description = "This test asserts that an Account Admin can assign roles to users."
	@priority = "5"
	test AccountAdminCanAssignRolesToUsers {
		property portal.acceptance = "true";

		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("and another user in the business account") {
			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");
		}

		task ("When the Account Admin log in and assigns a role to a user") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Users");

			Accounts.addAssigneeToRoleViaUsersTab(
				accountRoleTitle = "Account Administrator",
				accountUserName = "user1 user1");
		}

		task ("Then the new user has 'Account Administator' listed in their role") {
			AssertTextEquals(
				key_columnName = "lfr-account-roles-column",
				key_rowEntry = "user1 user1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER_TD",
				value1 = "Account Administrator");
		}
	}

	@description = "This test asserts that an Account can be deactivated and will show Active and Inactive filters."
	@priority = "4"
	@refactorneeded
	test AccountAdminCanDeactivateAccount {
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		Permissions.definePermissionViaJSONAPI(
			resourceAction = "DELETE",
			resourceName = "com.liferay.account.model.AccountEntry",
			roleTitle = "Account Administrator",
			roleType = "account");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.goToEntryMenuItem(
			menuItem = "Deactivate",
			rowEntry = "Account Name");

		AssertConfirm(value1 = "Are you sure you want to deactivate this?");

		Alert.viewSuccessMessage();

		Accounts.viewInactiveAccount(accountName = "Account Name");
	}

	@description = "This test asserts that an Account can be deleted."
	@priority = "4"
	@refactorneeded
	test AccountAdminCanDeleteAccount {
		property portal.acceptance = "true";

		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		Permissions.definePermissionViaJSONAPI(
			resourceAction = "DELETE",
			resourceName = "com.liferay.account.model.AccountEntry",
			roleTitle = "Account Administrator",
			roleType = "account");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.goToEntryMenuItem(
			menuItem = "Delete",
			rowEntry = "Account Name");

		AssertConfirm(value1 = "Are you sure you want to delete this? It will be deleted immediately.");

		Alert.viewSuccessMessage();
	}

	@description = "This test asserts that an Account Admin can edit an account he is assigned to."
	@priority = "5"
	test AccountAdminCanEditAccount {
		property portal.acceptance = "true";

		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin log in and edits an account") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Edit",
				rowEntry = "Account Name");

			AssertTextEquals(
				key_portletName = "Account",
				locator1 = "Portlet#TITLE",
				value1 = "Edit Account Name");

			PortletEntry.inputName(name = "This is a new update");

			Button.clickSave();
		}

		task ("Then the account is edited successfully") {
			Alert.viewSuccessMessage();

			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.viewEntryName(rowEntry = "This is a new update");

			LexiconEntry.viewNoEntry(rowEntry = "Account Name");
		}
	}

	@description = "This test asserts that an Account Administrator can edit the info of users who belong to that account."
	@priority = "4"
	@refactorneeded
	test AccountAdminCanEditOtherUserInfo {
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		task ("Sign in as Super User and add additional user into an account") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "test@liferay.com",
				userLoginFullName = "Test Test");

			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "userea1@liferay.com",
				userFirstName = "userfn1",
				userLastName = "userln1",
				userScreenName = "usersn1");
		}

		task ("Create and assign a new role to Account Admin that allows for them to view and edit other users") {
			JSONRole.addRegularRole(roleTitle = "Edit User Role");

			for (var resourceActionIndex : list "UPDATE,VIEW") {
				Permissions.definePermissionViaJSONAPI(
					resourceAction = "${resourceActionIndex}",
					resourceName = "com.liferay.portal.kernel.model.User",
					roleTitle = "Edit User Role");
			}

			JSONRole.assignRoleToUser(
				roleTitle = "Edit User Role",
				userEmailAddress = "userea@liferay.com");
		}

		task ("Sign back in as Account Admin and edit the other user name") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Navigator.gotoNavTab(navTab = "Users");

			AccountUsers.editUser(
				accountManagementWidget = "true",
				accountUser = "userfn1 userln1",
				editFirstName = "userEdit");
		}

		task ("Assert that the user has the edited first name and the original name cannot be found") {
			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Navigator.gotoNavTab(navTab = "Users");

			LexiconEntry.viewEntryName(rowEntry = "userEdit userln1");

			LexiconEntry.viewNoEntry(rowEntry = "userfn1 userln1");
		}
	}

	@description = "This test asserts that an Account Admin cannot add a user wtih an email domain that is blocked."
	@priority = "4"
	test AccountAdminCannotAddUserWithBlockedDomain {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("and a blocked domain is set") {
			AccountConfiguration.enableAccountEmailDomain();

			AccountConfiguration.addBlockedEmailDomain(settingValues = "gmail.com");
		}

		task ("When the Account Admin log in and adds a user using the email domain blocked previously") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");

			Accounts.viewErrorWhenAddingUserWithBlockedDomain(
				accountName = "Account Name",
				assigneeName = "gmailUser",
				emailDomainName = "gmail.com",
				userEmailAddress = "userea@gmail.com",
				userFirstName = "gmailUser",
				userLastName = "gmailUser",
				userScreenName = "blockedUser");
		}

		task ("Then the new user is not added into the account") {
			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");

			LexiconEntry.viewNoEntry(rowEntry = "gmailUser gmailUser");
		}
	}

	@description = "This test asserts that an Account Admin can set a billing address to an Account."
	@priority = "5"
	@refactorneeded
	test AccountAdminCanSetDefaultBillingAddress {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin log in and sets the default billing address") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Edit",
				rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			Accounts.addAddressViaSetDefaultAddress(
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Liferay, Inc.",
				addressPostalCode = "91765",
				addressRegion = "California",
				addressStreet1 = "1400 Montefino Ave",
				addressType = "Billing",
				phoneNumber = "+1-877-543-3729");

			Accounts.gotoAssigneeTab(assigneeTab = "Details");

			Accounts.setDefaultBillingAddress(addressName = "Liferay, Inc.");
		}

		task ("Then the default billing address is successfully set") {
			AssertElementPresent(
				key_tab = "Details",
				locator1 = "NavTab#ACTIVE_TAB_LINK");

			Accounts.viewDefaultBillingAddress(
				addressCity = "Diamond Bar",
				addressCountry = "United States",
				addressName = "Liferay, Inc.",
				addressPostalCode = "91765",
				addressRegion = "California",
				addressStreet1 = "1400 Montefino Ave",
				phoneNumber = "+1-877-543-3729");
		}
	}

	@description = "This test asserts that an Account Admin can set a shipping address to an Account."
	@priority = "5"
	test AccountAdminCanSetDefaultShippingAddress {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin log in and sets the default shipping address") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Edit",
				rowEntry = "Account Name");

			Accounts.gotoAssigneeTab(assigneeTab = "Addresses");

			Accounts.addAddressViaSetDefaultAddress(
				addressCity = "Shibuya-ku",
				addressCountry = "Japan",
				addressName = "Liferay Japan K. K.",
				addressPostalCode = "150-0021",
				addressRegion = "Tokyo",
				addressStreet1 = "1F Faveur Ebisu,",
				addressStreet2 = "1-26-7 Ebisu Nishi",
				addressType = "Shipping",
				phoneNumber = "+81 3-5456-5796");

			Accounts.gotoAssigneeTab(assigneeTab = "Details");

			Accounts.setDefaultShippingAddress(addressName = "Liferay Japan K. K.");
		}

		task ("Then the default shipping address is successfully set") {
			AssertElementPresent(
				key_tab = "Details",
				locator1 = "NavTab#ACTIVE_TAB_LINK");

			Accounts.viewDefaultShippingAddress(
				addressCity = "Shibuya-ku",
				addressCountry = "Japan",
				addressName = "Liferay Japan K. K.",
				addressPostalCode = "150-0021",
				addressRegion = "Tokyo",
				addressStreet1 = "1F Faveur Ebisu,",
				addressStreet2 = "1-26-7 Ebisu Nishi",
				phoneNumber = "+81 3-5456-5796");
		}
	}

	@description = "This test asserts that an Account Admin can add and unassign organization in bulk"
	@priority = "5"
	@refactorneeded
	test AccountAdminCanUnassignOrganizationsInBulk {
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		Permissions.definePermissionViaJSONAPI(
			resourceAction = "MANAGE_ORGANIZATIONS",
			resourceName = "com.liferay.account.model.AccountEntry",
			roleTitle = "Account Administrator",
			roleType = "account");

		for (var organizationNumber : list "1,2,3,4") {
			JSONOrganization.addOrganization(
				organizationName = "Organization ${organizationNumber}",
				organizationSite = "true");
		}

		Accounts.openAccountsAdmin();

		LexiconEntry.gotoEntry(rowEntry = "Account Name");

		Accounts.assignMultipleOrganizations(
			accountName = "Account Name",
			organizationNumber = "1,3,4");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		LexiconEntry.gotoEntry(rowEntry = "Account Name");

		Accounts.unassignMultipleOrganizations(
			accountName = "Account Name",
			organizationNumber = "1,3,4");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.viewNoAssignee(
			accountName = "Account Name",
			assigneeType = "Organizations");
	}

	@description = "This test asserts that an Account Admin can add and unassign organization to an account"
	@priority = "5"
	@refactorneeded
	test AccountAdminCanUnassignOrganizationToAccount {
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test");

		Permissions.definePermissionViaJSONAPI(
			resourceAction = "MANAGE_ORGANIZATIONS",
			resourceName = "com.liferay.account.model.AccountEntry",
			roleTitle = "Account Administrator",
			roleType = "account");

		JSONOrganization.addOrganization(
			organizationName = "Organization for Account",
			organizationSite = "true");

		Accounts.openAccountsAdmin();

		LexiconEntry.gotoEntry(rowEntry = "Account Name");

		Accounts.assignOrganizations(
			accountName = "Account Name",
			assigneeName = "Organization for Account");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		LexiconEntry.gotoEntry(rowEntry = "Account Name");

		Accounts.gotoAssigneeTab(assigneeTab = "Organizations");

		Accounts.removeOrganizationAsAssignee(
			accountName = "Account Name",
			assigneeName = "Organization for Account");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.viewNoAssignee(
			accountName = "Account Name",
			assigneeType = "Organizations");
	}

	@description = "This test asserts that an Account Admin can unassign roles to users."
	@priority = "5"
	@refactorneeded
	test AccountAdminCanUnassignRolesToUsers {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("and an Account User is given a role by the Account Administrator") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Accounts.addOwnedAccountRole(accountRoleTitle = "Account Specific Role");

			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "user1@liferay.com",
				userFirstName = "user1",
				userLastName = "user1",
				userScreenName = "user1");

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Accounts.addAssigneeToRoleViaUsersTab(
				accountRoleTitle = "Account Specific Role",
				accountUserName = "user1 user1");

			AssertTextEquals(
				key_columnName = "lfr-account-roles-column",
				key_rowEntry = "user1 user1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER_TD",
				value1 = "Account Specific Role");
		}

		task ("When the Account Administrator unassigns that role") {
			Accounts.unassignUserRole(
				accountRoleTitle = "Account Specific Role",
				accountUserName = "user1 user1");
		}

		task ("Then that user should no longer have that role associated with them") {
			AssertTextNotEquals(
				key_columnName = "lfr-account-roles-column",
				key_rowEntry = "user1 user1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER_TD",
				value1 = "Account Specific Role");
		}
	}

	@description = "This test searches for an Account within the list by Account Name and Account ID."
	@priority = "5"
	test AccountMemberCanSearchForAccountViaNameAndID {
		task ("Given a user assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the member logs in and searches for an account via name") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Search.searchPG(
				portletName = "Account Management",
				searchTerm = "Account Name");
		}

		task ("Then the search results display the account") {
			LexiconEntry.viewEntryName(rowEntry = "Account Name");
		}

		task ("When the member logs in and searches for an account via ID") {
			Accounts.searchAccountsViaId(accountName = "Account Name");
		}

		task ("Then the search results display the account") {
			LexiconEntry.viewEntryName(rowEntry = "Account Name");
		}
	}

	@description = "This test asserts an account member can search accounts they belong to"
	@priority = "3"
	test AccountMemberCanSearchForAnAccount {
		task ("Given an account user assigned to two accounts") {
			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Test",
				accountEntryType = "Business");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Test",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the new account member signs in and views the accounts they are a part of through the Account Management widget") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");
		}

		task ("Then the member can use the search bar to filter out the accounts they belong to") {
			Search.searchPG(
				portletName = "Account Management",
				searchTerm = "Name");

			LexiconEntry.viewEntryName(rowEntry = "Account Name");

			LexiconEntry.viewNoEntry(rowEntry = "Account Test");

			Search.searchPG(
				portletName = "Account Management",
				searchTerm = "Test");

			LexiconEntry.viewEntryName(rowEntry = "Account Test");

			LexiconEntry.viewNoEntry(rowEntry = "Account Name");
		}
	}

	@description = "This test asserts that account users can be ordered by First Name, Last Name, Email."
	@priority = "4"
	test AdminCanOrderUsers {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("and a few users added to account") {
			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "userea1@liferay.com",
				userFirstName = "userfn1",
				userLastName = "userln5",
				userScreenName = "usersn1");

			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "userea3@liferay.com",
				userFirstName = "userfn5",
				userLastName = "userln2",
				userScreenName = "usersn2");
		}

		task ("When the Account Admin log in and views users") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");
		}

		task ("Then users can be ordered by First Name") {
			ManagementBar.setFilterAndOrder(orderBy = "First Name");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn userln");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "2",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn1 userln5");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "3",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn5 userln2");
		}

		task ("and users can be ordered by Last Name") {
			ManagementBar.setFilterAndOrder(orderBy = "Last Name");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn userln");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "2",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn5 userln2");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "3",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn1 userln5");
		}

		task ("and users can be ordered by Email Address") {
			ManagementBar.setFilterAndOrder(orderBy = "Email Address");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "1",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn1 userln5");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "2",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn5 userln2");

			AssertTextEquals.assertPartialText(
				key_rowNumber = "3",
				locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER",
				value1 = "userfn userln");
		}
	}

	@description = "This test asserts Account Administrators can search for account users"
	@priority = "5"
	test AdminCanSearchForAccountUsers {
		property portal.acceptance = "true";

		task ("Given a Business Account with account users assigned to it") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			for (var userNum : list "1,2,3,4") {
				JSONAccountEntryUser.addAccountEntryUser(
					accountEntryName = "Account Name",
					userEmailAddress = "userea${userNum}@liferay.com",
					userFirstName = "userfn${userNum}",
					userLastName = "userln${userNum}",
					userScreenName = "usersn${userNum}");
			}
		}

		task ("and one of them is assigned a password and the Account Administrator role") {
			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea1@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea1@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea1@liferay.com");
		}

		task ("When the Account Admin logs in and views account users") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea1@liferay.com",
				userLoginFullName = "userfn1 userln1");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");
		}

		task ("Then all users can be searched by first last name") {
			for (var userNum : list "2,3,4") {
				Search.searchPG(
					portletName = "Account Name",
					searchTerm = "userfn${userNum} userln${userNum}");

				LexiconEntry.viewEntryName(rowEntry = "userfn${userNum} userln${userNum}");

				LexiconEntry.viewNoEntry(rowEntry = "userfn1 userln1");

				if ("${userNum}" == "2") {
					LexiconEntry.viewNoEntry(rowEntry = "userfn3 userln3");

					LexiconEntry.viewNoEntry(rowEntry = "userfn4 userln4");
				}
				else if ("${userNum}" == "3") {
					LexiconEntry.viewNoEntry(rowEntry = "userfn2 userln2");

					LexiconEntry.viewNoEntry(rowEntry = "userfn4 userln4");
				}
				else {
					LexiconEntry.viewNoEntry(rowEntry = "userfn2 userln3");

					LexiconEntry.viewNoEntry(rowEntry = "userfn3 userln3");
				}
			}
		}

		task ("and all users can be searched by email") {
			for (var userNum : list "2,3,4") {
				Search.searchPG(
					portletName = "Account Name",
					searchTerm = "userea${userNum}@liferay.com");

				LexiconEntry.viewEntryName(rowEntry = "userea${userNum}@liferay.com");

				LexiconEntry.viewNoEntry(rowEntry = "userea@liferay.com");

				if ("${userNum}" == "2") {
					LexiconEntry.viewNoEntry(rowEntry = "userea3@liferay.com");

					LexiconEntry.viewNoEntry(rowEntry = "userea4@liferay.com");
				}
				else if ("${userNum}" == "3") {
					LexiconEntry.viewNoEntry(rowEntry = "userea2@liferay.com");

					LexiconEntry.viewNoEntry(rowEntry = "userea4@liferay.com");
				}
				else {
					LexiconEntry.viewNoEntry(rowEntry = "userea2@liferay.com");

					LexiconEntry.viewNoEntry(rowEntry = "userea3@liferay.com");
				}
			}
		}
	}

	@description = "This test asserts Account Administrators can view all account users"
	@priority = "5"
	@refactorneeded
	test AdminCanViewAllAccountUsers {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("Add several users to account") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "test@liferay.com",
				userLoginFullName = "Test Test");

			for (var userNum : list "2,3,4") {
				JSONAccountEntryUser.addAccountEntryUser(
					accountEntryName = "Account Name",
					userEmailAddress = "userea${userNum}@liferay.com",
					userFirstName = "userfn${userNum}",
					userLastName = "userln${userNum}",
					userScreenName = "usersn${userNum}");
			}
		}

		task ("Assert all users can be viewed") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");

			LexiconEntry.viewEntryName(rowEntry = "userfn userln");

			for (var userNum : list "2,3,4") {
				LexiconEntry.viewEntryName(rowEntry = "userfn${userNum} userln${userNum}");
			}
		}
	}

	@description = "This is a test for LRQA-73702 and asserts that a user can see all accounts that they belong to"
	@priority = "5"
	test CanAccessAListOfAccountsTheUserBelongsTo {
		task ("Given a user") {
			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");
		}

		task ("and two Business Accounts") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Test Account Member",
				accountEntryType = "Business");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Test Account Non-Member",
				accountEntryType = "Business");
		}

		task ("and the user is added to one of the accounts") {
			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.gotoEntry(rowEntry = "Test Account Member");

			Accounts.assignUsers(
				accountName = "Test Account Member",
				assigneeName = "userfn userln");
		}

		task ("When that user logs in and views the account page") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");
		}

		task ("Then the user should only see accounts they belong to") {
			LexiconEntry.viewEntryName(rowEntry = "Test Account Member");

			LexiconEntry.viewNoEntry(rowEntry = "Test Account Non-Member");
		}
	}

	@description = "This test checks that the size of the pagination list can be changed."
	@priority = "4"
	@refactorneeded
	test CanChangePaginationInAccounts {
		JSONAccountEntry.addAccountEntry(
			accountEntryName = "Account Name",
			accountEntryType = "Business");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");

		JSONAccountEntryUser.addExistUsertoAccount(
			accountEntryName = "Account Name",
			userEmailAddress = "userea@liferay.com");

		JSONAccountRole.associateUser(
			accountEntryName = "Account Name",
			accountRole = "Account Administrator",
			userEmailAddress = "userea@liferay.com");

		for (var accountNum : list "1,2,3,4,5") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name ${accountNum}",
				accountEntryType = "Business");
		}

		for (var accountNames : list "Account Name 1,Account Name 2,Account Name 3,Account Name 4,Account Name 5") {
			Accounts.openAccountsAdmin();

			LexiconEntry.gotoEntry(rowEntry = "${accountNames}");

			Accounts.assignUsers(
				accountName = "${accountNames}",
				assigneeName = "userfn userln");
		}

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		AssertElementPresent(locator1 = "Pagination#PAGINATION_BAR");

		for (var listEntries : list "4,8,20,60") {
			Pagination.changePagination(itemsPerPage = "${listEntries}");

			if ("${listEntries}" == "4") {
				Pagination.viewResults(results = "Showing 1 to 4 of 6 entries.");

				LexiconEntry.viewNoEntry(rowEntry = "Account Name 4");

				LexiconEntry.viewNoEntry(rowEntry = "Account Name 5");

				for (var accountEntries : list "Account Name,Account Name 1,Account Name 2,Account Name 3") {
					LexiconEntry.viewEntryName(rowEntry = "${accountEntries}");
				}

				Click(locator1 = "Pagination#NEXT_LINK");

				Pagination.viewResults(results = "Showing 5 to 6 of 6 entries.");

				LexiconEntry.viewEntryName(rowEntry = "Account Name 4");

				LexiconEntry.viewEntryName(rowEntry = "Account Name 5");

				for (var accountEntries : list "Account Name,Account Name 1,Account Name 2,Account Name 3") {
					LexiconEntry.viewNoEntry(rowEntry = "${accountEntries}");
				}
			}
			else {
				Pagination.viewResults(results = "Showing 1 to 6 of 6 entries.");

				for (var allAccounts : list "Account Name,Account Name 1,Account Name 2,Account Name 3,Account Name 4,Account Name 5") {
					LexiconEntry.viewEntryName(rowEntry = "${allAccounts}");
				}
			}
		}
	}

	@description = "This test asserts that account users can be filtered by status."
	@priority = "4"
	test CanFilterAccountUsersByStatus {
		task ("Given an account with active and inactive users") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			for (var userNum : list "1,2,3,4") {
				JSONAccountEntryUser.addAccountEntryUser(
					accountEntryName = "Account Name",
					userEmailAddress = "userea${userNum}@liferay.com",
					userFirstName = "userfn${userNum}",
					userLastName = "userln${userNum}",
					userScreenName = "usersn${userNum}");
			}

			AccountUsers.openAccountUsersAdmin();

			for (var userNum : list "3,4") {
				AccountUsers.deactivateUser(userFirstName = "userfn${userNum}");
			}
		}

		task ("and one of the users is assigned a password and the Account Administrator role") {
			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea1@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea1@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea1@liferay.com");
		}

		task ("When the Account Admin logs in and views account users") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea1@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");

			Accounts.goToEntryMenuItem(
				menuItem = "Manage Users",
				rowEntry = "Account Name");
		}

		task ("Then users can be filtered by Active status") {
			ManagementBar.setFilterAndOrder(filterBy = "Active");

			for (var userNum : list "1,2") {
				LexiconEntry.viewEntryName(rowEntry = "userfn${userNum} userln${userNum}");
			}

			for (var userNum : list "3,4") {
				LexiconEntry.viewNoEntry(rowEntry = "userfn${userNum} userln${userNum}");
			}
		}

		task ("and users can be filtered by Inactive status") {
			ManagementBar.setFilterAndOrder(filterBy = "Inactive");

			for (var userNum : list "3,4") {
				LexiconEntry.viewEntryName(rowEntry = "userfn${userNum} userln${userNum}");
			}

			for (var userNum : list "1,2") {
				LexiconEntry.viewNoEntry(rowEntry = "userfn${userNum} userln${userNum}");
			}
		}
	}

	@description = "This test asserts that an Account Admin cannot view accounts not assigned to him."
	@priority = "5"
	test CannotViewOtherAccounts {
		property portal.acceptance = "true";

		task ("Given there are two Business Accounts") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name 2",
				accountEntryType = "Business");
		}

		task ("and an Account Administrator is assigned to one account") {
			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("When the Account Admin logs in and views his Account Management widget") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "userea@liferay.com",
				userLoginFullName = "userfn userln");

			Navigator.gotoPage(pageName = "2B Account Page");
		}

		task ("Then only the account assigned to him displays") {
			LexiconEntry.viewEntryName(rowEntry = "Account Name");

			LexiconEntry.viewNoEntry(rowEntry = "Account Name 2");
		}
	}

	@description = "This test asserts that an Account Admin can remove a user from an account."
	@priority = "5"
	@refactorneeded
	test CanRemoveUserFromAccount {
		property portal.acceptance = "true";

		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		JSONAccountEntryUser.addAccountEntryUser(
			accountEntryName = "Account Name",
			userEmailAddress = "user1@liferay.com",
			userFirstName = "user1",
			userLastName = "user1",
			userScreenName = "user1");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		JSONAccountEntryUser.addAccountEntryUser(
			accountEntryName = "Account Name",
			userEmailAddress = "user2@liferay.com",
			userFirstName = "user2",
			userLastName = "user2",
			userScreenName = "user2");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.goToEntryMenuItem(
			menuItem = "Manage Users",
			rowEntry = "Account Name");

		AssertElementPresent(
			key_tab = "Users",
			locator1 = "NavTab#ACTIVE_TAB_LINK");

		for (var users : list "user1 user1,user2 user2") {
			Accounts.goToEntryMenuItem(
				menuItem = "Remove",
				rowEntry = "${users}");

			AssertConfirm(value1 = "Are you sure you want to remove this user?");
		}

		Navigator.gotoPage(pageName = "2B Account Page");

		Search.searchPG(
			portletName = "Account Management",
			searchTerm = "Account Name");

		Accounts.goToEntryMenuItem(
			menuItem = "Manage Users",
			rowEntry = "Account Name");

		LexiconEntry.viewNoEntry(rowEntry = "user1");

		LexiconEntry.viewNoEntry(rowEntry = "user2");
	}

	@description = "This test filters Accounts by status."
	@priority = "4"
	@refactorneeded
	test FilterByStatus {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		Accounts.setAddAccountEntryPermissions(
			roleTitle = "Reg Role Name",
			userEmailAddress = "userea@liferay.com");

		Permissions.definePermissionViaJSONAPI(
			resourceAction = "DELETE",
			resourceName = "com.liferay.account.model.AccountEntry",
			roleTitle = "Account Administrator",
			roleType = "account");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.addBusinessAccount(accountName = "New Active Account");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.goToEntryMenuItem(
			menuItem = "Deactivate",
			rowEntry = "Account Name");

		AssertConfirm(value1 = "Are you sure you want to deactivate this?");

		Alert.viewSuccessMessage();

		Accounts.viewInactiveAccount(accountName = "Account Name");

		LexiconEntry.viewNoEntry(rowEntry = "New Active Account");

		ManagementBar.setFilterAndOrder(filterBy = "Active");

		LexiconEntry.viewNoEntry(rowEntry = "Account Name");

		LexiconEntry.viewEntryStatus(
			rowEntry = "New Active Account",
			rowStatus = "Active");
	}

	@description = "This test filters Accounts by Account Type."
	@priority = "3"
	@refactorneeded
	test FilterByType {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		Accounts.setAddAccountEntryPermissions(
			roleTitle = "Reg Role Name",
			userEmailAddress = "userea@liferay.com");

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln");

		Navigator.gotoPage(pageName = "2B Account Page");

		Accounts.addPersonAccount(accountName = "Person Account");

		Navigator.gotoPage(pageName = "2B Account Page");

		for (var allAccounts : list "Account Name,Person Account") {
			LexiconEntry.viewEntryName(rowEntry = "${allAccounts}");
		}

		for (var filter : list "Business,Person") {
			ManagementBar.setFilterAndOrder(filterBy = "${filter}");

			if ("${filter}" == "Business") {
				LexiconEntry.viewEntryName(rowEntry = "Account Name");

				LexiconEntry.viewNoEntry(rowEntry = "Person Account");
			}
			else if ("${filter}" == "Person") {
				LexiconEntry.viewEntryName(rowEntry = "Person Account");

				LexiconEntry.viewNoEntry(rowEntry = "Account Name");
			}
		}
	}

	@description = "This test asserts that multiple users can be assigned to roles simultaneously."
	@priority = "5"
	@refactorneeded
	test ManyToManyRelationshipAssignmentIsPossible {
		task ("Given there is an Account Administrator assigned to a Business Account") {
			JSONAccountEntry.addAccountEntry(
				accountEntryName = "Account Name",
				accountEntryType = "Business");

			JSONUser.addUser(
				userEmailAddress = "userea@liferay.com",
				userFirstName = "userfn",
				userLastName = "userln",
				userScreenName = "usersn");

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = "userea@liferay.com");

			JSONAccountEntryUser.addExistUsertoAccount(
				accountEntryName = "Account Name",
				userEmailAddress = "userea@liferay.com");

			JSONAccountRole.associateUser(
				accountEntryName = "Account Name",
				accountRole = "Account Administrator",
				userEmailAddress = "userea@liferay.com");
		}

		task ("Given an additional account user is created") {
			JSONAccountEntryUser.addAccountEntryUser(
				accountEntryName = "Account Name",
				userEmailAddress = "userea2@liferay.com",
				userFirstName = "userfn2",
				userLastName = "userln2",
				userScreenName = "usersn2");

			task ("And given a new account role is created") {
				Accounts.openAccountsAdmin();

				LexiconEntry.gotoEntry(rowEntry = "Account Name");

				Accounts.addOwnedAccountRole(accountRoleTitle = "Test Account Role");
			}
		}

		task ("When both account users are assigned to the default 'Account Administrator' role and the newly created role") {
			Navigator.gotoPage(pageName = "2B Account Page");

			LexiconEntry.gotoEntry(rowEntry = "Account Name");

			Accounts.addAssigneeToRoleViaUsersTab(
				accountRoleTitle = "Account Administrator",
				accountUserName = "userfn2");

			for (var accountUserName : list "userfn,userfn2") {
				Accounts.openAccountsAdmin();

				LexiconEntry.gotoEntry(rowEntry = "Account Name");

				Accounts.addAssigneeToRoleViaUsersTab(
					accountRoleTitle = "Test Account Role",
					accountUserName = "${accountUserName}");
			}
		}

		task ("Then the accounts table should display both users holding both roles simultaneously") {
			for (var user : list "userfn userln,userfn2 userln2") {
				AssertTextEquals(
					key_columnName = "lfr-account-roles-column",
					key_rowEntry = "${user}",
					locator1 = "ContentRow#ENTRY_CONTENT_ROW_NUMBER_TD",
					value1 = "Account Administrator, Test Account Role");
			}
		}
	}

}